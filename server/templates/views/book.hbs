<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Your Gym Session</title>
    <link rel="stylesheet" href="./book.css">
</head>
<body>
    <header>
        <h1>Book Your Gym Session</h1>
        <p>Select your preferences and schedule your workout!</p>
    </header>
    <!-- Preferred Day Section -->
    <section class="category">
        <h2>Preferred Day</h2>
        <div class="card-container">
          <div class="card available" data-value="Monday" data-category="preferredDay">Monday</div>
          <div class="card available" data-value="Tuesday" data-category="preferredDay">Tuesday</div>
          <div class="card available" data-value="Wednesday" data-category="preferredDay">Wednesday</div>
          <div class="card available" data-value="Thursday" data-category="preferredDay">Thursday</div>
          <div class="card available" data-value="Friday" data-category="preferredDay">Friday</div>
          <div class="card available" data-value="Saturday" data-category="preferredDay">Saturday</div>
        </div>
      </section>
    
      <!-- Exercise Type Section -->
      <section class="category">
        <h2>Exercise Type</h2>
        <div class="card-container">
          <div class="card available" data-value="Cardio" data-category="exerciseType">Cardio</div>
          <div class="card available" data-value="Yoga" data-category="exerciseType">Yoga</div>
          <div class="card available" data-value="Strength-Training" data-category="exerciseType">Strength-Training</div>
          <div class="card available" data-value="Zumba" data-category="exerciseType">Zumba</div>
          <div class="card available" data-value="Weight-Lifting" data-category="exerciseType">Weight-Lifting</div>
          <div class="card available" data-value="Pilates" data-category="exerciseType">Pilates</div>
        </div>
      </section>
    
      <!-- Time Slot Section -->
      <section class="category">
        <h2>Preferred Time Slot</h2>
        <div class="card-container">
          <div class="card available" data-value="6:00 AM - 7:00 AM" data-category="timeSlot">6:00 AM - 7:00 AM</div>
          <div class="card available" data-value="7:00 AM - 8:00 AM" data-category="timeSlot">7:00 AM - 8:00 AM</div>
          <div class="card available" data-value="8:00 AM - 9:00 AM" data-category="timeSlot">8:00 AM - 9:00 AM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">9:00 AM - 10:00 AM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">10:00 AM - 11:00 AM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">11:00 AM - 12:00 AM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">12:00 AM - 1:00 PM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">1:00 PM - 2:00 PM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">2:00 PM - 3:00 PM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">3:00 PM - 4:00 PM</div>
          <div class="card available" data-value="9:00 AM - 10:00 AM" data-category="timeSlot">4:00 PM - 5:00 PM</div>

        </div>
      </section>
    
      <!-- Trainer Section -->
      <section class="category">
        <h2>Preferred Trainer</h2>
        <div class="card-container">
          <div class="card available" data-value="John Doe" data-category="trainer">John Doe</div>
          <div class="card available" data-value="Jane Smith" data-category="trainer">Jane Smith</div>
          <div class="card available" data-value="Alex Johnson" data-category="trainer">Alex Johnson</div>
        </div>
      </section>
    
      <!-- Session Type Section -->
      <section class="category">
        <h2>Session Type</h2>
        <div class="card-container">
          <div class="card available" data-value="Online" data-category="sessionType">Online</div>
          <div class="card available" data-value="Offline" data-category="sessionType">Offline</div>
        </div>
      </section>
    
      <!-- Book Now Button -->
      <div class="book-now">
        <button id="book-now">Book Now</button>
      </div>

      <script>
          document.getElementById("book-now").addEventListener("click", function() {
          const preferredDay = document.querySelector('.card.selected[data-category="preferredDay"]')?.dataset.value;
          const exerciseType = document.querySelector('.card.selected[data-category="exerciseType"]')?.dataset.value;
          const timeSlot = document.querySelector('.card.selected[data-category="timeSlot"]')?.dataset.value;
          const trainer = document.querySelector('.card.selected[data-category="trainer"]')?.dataset.value;
          const sessionType = document.querySelector('.card.selected[data-category="sessionType"]')?.dataset.value;

          if (preferredDay && exerciseType && timeSlot && trainer && sessionType) {
              const bookingData = { preferredDay, exerciseType, timeSlot, trainer, sessionType };

              fetch("/book-session", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json"
                  },
                  body: JSON.stringify(bookingData)
              })
              .then(response => {
                  if (response.ok) {
                      alert("Booking successful!");
                      window.location.reload(); // Reload to update booked slots
                  } else if (response.status === 409) {
                      alert("This session is already booked.");
                      // Highlight the conflicting time slot in red
                      document.querySelector(`.card[data-value="${timeSlot}"][data-category="timeSlot"]`).style.backgroundColor = "red";
                  } else {
                      alert("Error booking session. Please try again.");
                  }
              })
              .catch(error => {
                  console.error("Error booking session:", error);
                  alert("Error booking session. Please try again.");
              });
          } else {
              alert("Please select all options before booking.");
          }
      });



      document.querySelectorAll('.card').forEach(card => {
          card.addEventListener('click', function() {
              const category = this.dataset.category;

              // Deselect all other cards in the same category
              document.querySelectorAll(`.card[data-category="${category}"]`).forEach(otherCard => {
                  otherCard.classList.remove('selected');
              });

              // Toggle the selected class on the clicked card
              this.classList.add('selected');
          });
      });




      window.onload = function() {
      fetch('/booked-slots')
          .then(response => response.json())
          .then(bookings => {
              bookings.forEach(booking => {
                  const { timeSlot, preferredDay, trainer } = booking;
                  const slotCard = document.querySelector(
                      `.card[data-value="${timeSlot}"][data-category="timeSlot"]`
                  );
                  if (slotCard) {
                      slotCard.classList.add('booked'); // Add a 'booked' class
                      slotCard.style.backgroundColor = 'red'; // Mark as booked
                      slotCard.style.pointerEvents = 'none'; // Disable clicking
                  }
              });
          })
          .catch(error => console.error("Error fetching booked slots:", error));
  };

      </script>
</body>
</html>
